<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDF ToolKit</title>
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
  />
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #6a11cb, #2575fc);
    }

    .container {
      background: #ffffff;
      padding: 40px 30px;
      border-radius: 20px;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
      width: 650px;
      max-width: 90%;
      text-align: center;
      transition: transform 0.3s, box-shadow 0.3s;
      box-sizing: border-box;
      margin-bottom: 20px;
    }

    .container:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }

    h2 {
      color: #333;
      margin-bottom: 25px;
      font-size: 1.8rem;
    }

    .tool-switcher {
      display: flex;
      position: relative;
      background: #2c3e50;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 25px;
    }

    .tool-switcher::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 33.33%;
      height: 100%;
      background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.4),
        rgba(255, 255, 255, 0.2)
      );
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.5);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      border-radius: 11px;
      transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      z-index: 1;
    }

    .tool-switcher.html-active::before {
      transform: translateX(100%);
    }
    .tool-switcher.compress-active::before {
      transform: translateX(200%);
    }

    .tool-switcher button {
      flex: 1;
      padding: 12px;
      background: transparent;
      color: #bdc3c7;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: bold;
      transition: color 0.4s ease-out;
      margin: 0;
      border-radius: 0;
      position: relative;
      z-index: 2;
      letter-spacing: 1px;
    }

    .tool-switcher button.active {
      color: #ffffff;
    }

    .tool-switcher button span {
      display: inline-block;
      transition: transform 0.2s ease-out;
    }

    .tool-switcher button span.enlarge {
      transform: scale(1.3);
    }

    .tool-content.hidden {
      display: none;
    }

    .tool-area-wrapper {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 12px;
      padding: 25px;
      margin-top: 25px;
    }

    #compress-tool h3 {
      font-size: 1.5rem;
      color: #333;
      margin-top: 20px;
    }
    #compress-tool p {
      color: #777;
      margin-top: 10px;
      line-height: 1.5;
    }

    input[type="file"] {
      display: block;
      padding: 30px 20px;
      border: 2px dashed #bbb;
      border-radius: 12px;
      width: 100%;
      box-sizing: border-box;
      cursor: pointer;
      background: #fafafa;
      transition: border-color 0.3s, background 0.3s;
    }

    input[type="file"]:hover {
      border-color: #007bff;
      background: #f0f8ff;
    }

    .tool-content button {
      margin-top: 25px;
      padding: 12px 25px;
      width: 100%;
      background: linear-gradient(90deg, #6a11cb, #2575fc);
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1rem;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .tool-content button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }

    #toggle-offline {
      margin-top: 20px;
      display: none;
      background: #ff416c;
    }

    .tool-content footer {
      margin-top: 20px;
      font-size: 12px;
      color: #777;
    }

    .info-footer {
      background: rgba(255, 255, 255, 0.2);
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      text-align: center;
      color: #fff;
      font-size: 0.9rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    .info-footer a {
      color: #fff;
      text-decoration: underline;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>PDF ToolKit üõ†Ô∏è</h2>

    <div class="tool-switcher">
      <button id="show-merge-btn" class="active">PDF Merge</button>
      <button id="show-html-btn">HTML to PDF</button>
      <button id="show-compress-btn">PDF Compression</button>
    </div>

    <div class="tool-area-wrapper">
      <div id="merge-tool" class="tool-content">
        <input type="file" id="pdfs" multiple accept="application/pdf" />
        <button onclick="upload()">Merge PDFs</button>
        <footer>Hold Command (Mac) or Ctrl (Windows) to select multiple files</footer>
      </div>

      <!-- UPDATED HTML to PDF Panel -->
      <div id="html-tool" class="tool-content hidden">
        <input type="file" id="html_file" accept=".html" />
        <button onclick="convertHtmlFile()">Convert HTML File to PDF</button>
        <footer>Upload any HTML file, including those exported from Jupyter Notebook.</footer>
      </div>

      <!-- REVERTED PDF Compression Panel -->
      <div id="compress-tool" class="tool-content hidden">
        <h3>Coming Soon!</h3>
        <p>We're working hard to bring you a powerful PDF compression tool. Stay tuned!</p>
      </div>
    </div>

    <button id="toggle-offline">Toggle Offline Mode</button>
  </div>

  <div class="info-footer">
    <p>Made by Swastiek Kala</p>
    <a href="https://github.com/HappyShadowCoder/FlaskPDFMerger.git" target="_blank">
      GitHub Repository
    </a>
  </div>

  <script>
    const toolSwitcher = document.querySelector('.tool-switcher');
    const showMergeBtn = document.getElementById('show-merge-btn');
    const showHtmlBtn = document.getElementById('show-html-btn');
    const showCompressBtn = document.getElementById('show-compress-btn');
    const mergeTool = document.getElementById('merge-tool');
    const htmlTool = document.getElementById('html-tool');
    const compressTool = document.getElementById('compress-tool');

    function wrapLetters(button) {
      button.innerHTML = button.textContent.trim().split('').map(letter => `<span>${letter === ' ' ? '&nbsp;' : letter}</span>`).join('');
    }

    function animateLetters(buttonToShow) {
      const letters = buttonToShow.querySelectorAll('span');
      letters.forEach((letter, index) => {
        setTimeout(() => {
          letter.classList.add('enlarge');
        }, index * 50);
      });
    }

    function resetLetters(buttonToHide) {
      const letters = buttonToHide.querySelectorAll('span');
      letters.forEach(letter => {
        letter.classList.remove('enlarge');
      });
    }

    wrapLetters(showMergeBtn);
    wrapLetters(showHtmlBtn);
    wrapLetters(showCompressBtn);

    animateLetters(showMergeBtn);

    showMergeBtn.addEventListener('click', () => {
      mergeTool.classList.remove('hidden');
      htmlTool.classList.add('hidden');
      compressTool.classList.add('hidden');

      showMergeBtn.classList.add('active');
      showHtmlBtn.classList.remove('active');
      showCompressBtn.classList.remove('active');

      toolSwitcher.classList.remove('html-active');
      toolSwitcher.classList.remove('compress-active');

      animateLetters(showMergeBtn);
      resetLetters(showHtmlBtn);
      resetLetters(showCompressBtn);
    });

    showHtmlBtn.addEventListener('click', () => {
      htmlTool.classList.remove('hidden');
      mergeTool.classList.add('hidden');
      compressTool.classList.add('hidden');

      showHtmlBtn.classList.add('active');
      showMergeBtn.classList.remove('active');
      showCompressBtn.classList.remove('active');

      toolSwitcher.classList.add('html-active');
      toolSwitcher.classList.remove('compress-active');

      animateLetters(showHtmlBtn);
      resetLetters(showMergeBtn);
      resetLetters(showCompressBtn);
    });

    showCompressBtn.addEventListener('click', () => {
      compressTool.classList.remove('hidden');
      mergeTool.classList.add('hidden');
      htmlTool.classList.add('hidden');

      showCompressBtn.classList.add('active');
      showMergeBtn.classList.remove('active');
      showHtmlBtn.classList.remove('active');

      toolSwitcher.classList.add('compress-active');
      toolSwitcher.classList.remove('html-active');

      animateLetters(showCompressBtn);
      resetLetters(showMergeBtn);
      resetLetters(showHtmlBtn);
    });

    async function upload() {
      const files = document.getElementById("pdfs").files;
      if (files.length < 2) {
        Toastify({
          text: "‚ö†Ô∏è Please select at least two PDFs",
          duration: 3000,
          gravity: "top",
          position: "center",
          style: { background: "linear-gradient(to right, #ff5f6d, #ffc371)" },
        }).showToast();
        return;
      }

      const loadingToast = Toastify({
        text: "‚è≥ Merging PDFs... please wait",
        duration: -1,
        gravity: "top",
        position: "center",
        style: { background: "linear-gradient(to right, #00b09b, #96c93d)" },
      });
      loadingToast.showToast();

      try {
        const formData = new FormData();
        for (let i = 0; i < files.length; i++) {
          formData.append("pdfs", files[i]);
        }
        const response = await fetch("/api/merge", {
          method: "POST",
          body: formData,
        });
        if (!response.ok) throw new Error("Server error while merging PDFs");
        const blob = await response.blob();
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "merged.pdf";
        link.click();
        loadingToast.hideToast();
        Toastify({
          text: "‚úÖ Merging completed! Download started.",
          duration: 3000,
          gravity: "top",
          position: "right",
          style: { background: "linear-gradient(to right, #56ab2f, #a8e063)" },
        }).showToast();
      } catch (error) {
        loadingToast.hideToast();
        Toastify({
          text: "‚ùå " + error.message,
          duration: 4000,
          gravity: "top",
          position: "right",
          style: { background: "linear-gradient(to right, #ff416c, #ff4b2b)" },
        }).showToast();
      }
    }

    // UPDATED HTML file conversion function
    async function convertHtmlFile() {
        const fileInput = document.getElementById("html_file");
        if (fileInput.files.length === 0) {
            Toastify({
                text: "‚ö†Ô∏è Please select an HTML file to upload",
                duration: 3000,
                gravity: "top",
                position: "center",
                style: { background: "linear-gradient(to right, #ff5f6d, #ffc371)" },
            }).showToast();
            return;
        }

        const loadingToast = Toastify({
            text: "‚è≥ Converting file... please wait",
            duration: -1,
            gravity: "top",
            position: "center",
            style: { background: "linear-gradient(to right, #00b09b, #96c93d)" },
        });
        loadingToast.showToast();

        try {
            const formData = new FormData();
            formData.append("html_file", fileInput.files[0]);

            const response = await fetch("/api/file-to-pdf", {
                method: "POST",
                body: formData,
            });

            if (!response.ok) {
              const errorData = await response.json();
              throw new Error(errorData.error || "Server error during conversion");
            }

            const blob = await response.blob();
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = fileInput.files[0].name.replace('.html', '.pdf');
            link.click();
            URL.revokeObjectURL(link.href);

            loadingToast.hideToast();
            Toastify({
                text: "‚úÖ Conversion complete! Download started.",
                duration: 3000,
                gravity: "top",
                position: "right",
                style: { background: "linear-gradient(to right, #56ab2f, #a8e063)" },
            }).showToast();
        } catch (error) {
            loadingToast.hideToast();
            Toastify({
                text: "‚ùå " + error.message,
                duration: 5000,
                gravity: "top",
                position: "right",
                style: { background: "linear-gradient(to right, #ff416c, #ff4b2b)" },
            }).showToast();
        }
    }

    async function checkAdmin() {
      try {
        const res = await fetch("/api/check_admin");
        const data = await res.json();
        if(data.is_admin){
          const btn = document.getElementById("toggle-offline");
          btn.style.display = "block";
          btn.onclick = async () => {
            const resp = await fetch("/admin/toggle_offline", { method: "POST" });
            const result = await resp.json();
            Toastify({
              text: result.message,
              duration: 3000,
              gravity: "top",
              position: "center",
              style: { background: "linear-gradient(to right, #56ab2f, #a8e063)" },
            }).showToast();
          };
        }
      } catch(err){
        console.error(err);
      }
    }
    checkAdmin();
  </script>
</body>
</html>

